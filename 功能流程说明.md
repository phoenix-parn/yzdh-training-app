# 学习功能流程详解

## 🎯 核心功能流程图

```
┌─────────────────────────────────────────────────────────────┐
│                         登录页面                              │
│  - 输入用户名/密码                                            │
│  - 测试账号: admin/123456                                     │
└────────────────────┬────────────────────────────────────────┘
                     │ 登录成功
                     ↓
┌─────────────────────────────────────────────────────────────┐
│                         首页                                  │
│  - 显示3个工法课程卡片                                        │
│  - 显示学习进度                                               │
│  - 快速进入课程                                               │
└────────────────────┬────────────────────────────────────────┘
                     │ 点击课程卡片
                     ↓
┌─────────────────────────────────────────────────────────────┐
│                      课程详情页                               │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  视频区域 (封面图 + 播放按钮)                        │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  学习进度: ████████░░░░░░░░ 45%                      │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  📚 基础认知模块 (M01)                ▼展开          │    │
│  │    ├─ 1.1 工法背景与价值 (3个知识点) ← 点击这里     │    │
│  │    ├─ 1.2 工法特点与适用范围                         │    │
│  │    └─ 1.3 核心术语与概念                             │    │
│  │  📚 核心技术模块 (M02)                ▶收起          │    │
│  │  📚 实操流程模块 (M03)                ▶收起          │    │
│  │  📚 保障体系模块 (M04)                ▶收起          │    │
│  └─────────────────────────────────────────────────────┘    │
└────────────────────┬────────────────────────────────────────┘
                     │ 点击小节
                     ↓
┌─────────────────────────────────────────────────────────────┐
│                   知识点详情页 ⭐核心功能                     │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  🏷️ 知识点ID: 1-1.1.1                                │    │
│  │  📖 标题: 现浇vs预制对比                             │    │
│  │  📂 模块: 工法背景与价值                             │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  📝 内容详情                                          │    │
│  │  ────────────────────────────────────────────        │    │
│  │  近年来，随着我国城市化进程的快速发展，地铁交通      │    │
│  │  成为解决城市交通拥堵问题的关键手段。                │    │
│  │                                                       │    │
│  │  同时装配式建筑的高速发展，对我国建筑产业转型起      │    │
│  │  到积极的促进作用。与传统现浇结构相比，预制装配      │    │
│  │  式结构具有工程质量易于控制，施工速度快...          │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  🖼️ 图片素材 (1)                                     │    │
│  │  ┌───────────────────────────────────────────┐      │    │
│  │  │                                             │      │    │
│  │  │   [现浇vs预制对比表.png]                    │      │    │
│  │  │   (890 KB)                                  │      │    │
│  │  │                                             │      │    │
│  │  └───────────────────────────────────────────┘      │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  📄 文档资料 (0)                                     │    │
│  │  (暂无文档)                                          │    │
│  └─────────────────────────────────────────────────────┘    │
└────────────────────┬────────────────────────────────────────┘
                     │ 返回按钮
                     ↓
              回到课程详情页
```

## 📱 底部导航栏 (始终显示)

```
┌─────────────────────────────────────────────────────────────┐
│  🏠 首页  │  📚 课程  │  📁 资料  │  👤 我的                  │
│  (active)                                                     │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 数据流转过程

### 1. 知识点内容加载流程

```
用户点击小节
    ↓
CourseDetailPage 触发导航
    ↓
App.tsx 解析路由参数
  - mfId: MF01
  - moduleId: M01  
  - knowledgeId: 1-1.1.1
    ↓
KnowledgePointPage 组件挂载
    ↓
useEffect 触发 loadContent()
    ↓
fetch('/course-materials/MF01/M01/content/1-1.1.1.json')
    ↓
解析JSON响应
    ↓
setContent(data) 更新状态
    ↓
页面渲染内容
  - 显示标题和模块
  - 显示文字内容
  - 显示图片列表
  - 显示文档列表
```

### 2. 图片加载流程

```
KnowledgePointPage 渲染
    ↓
遍历 content.images 数组
    ↓
生成 <img> 标签
  src="/course-materials/MF01/M01/images/1-1.1.1_现浇vs预制对比表.png"
    ↓
浏览器请求图片文件
    ↓
Vite 开发服务器从 public/ 目录提供文件
    ↓
图片显示在页面上
```

### 3. 学习时长统计流程

```
用户登录成功
    ↓
App.tsx useEffect 触发
    ↓
startSession(userId, userName)
  - 创建/更新用户统计数据
  - 记录会话开始时间
  - 启动定时器
    ↓
每60秒自动执行
    ↓
updateSessionDuration()
  - totalDuration += 60秒
  - 更新 localStorage
  - 更新全局统计
    ↓
用户访问个人中心
    ↓
ProfilePage 读取统计数据
  - getUserStatistics()
  - getGlobalStatistics()
    ↓
显示在页面上
```

---

## 🗂️ 文件结构与职责

### 前端组件

```
src/
├── App.tsx                          # 主应用,路由控制
│   ├── 登录状态检查
│   ├── 会话管理
│   └── 页面路由解析
│
├── components/
│   ├── LoginPage.tsx                # 登录页面
│   │   ├── 用户名/密码输入
│   │   ├── 登录验证
│   │   └── 测试账号提示
│   │
│   ├── HomePage.tsx                 # 首页
│   │   ├── 课程卡片展示
│   │   ├── 学习进度显示
│   │   └── 快速导航
│   │
│   ├── CourseDetailPage.tsx         # 课程详情页
│   │   ├── 视频播放区域
│   │   ├── 学习进度条
│   │   ├── 模块列表
│   │   ├── 小节列表
│   │   └── 点击小节导航到知识点
│   │
│   ├── KnowledgePointPage.tsx       # 知识点详情页 ⭐
│   │   ├── 动态加载JSON内容
│   │   ├── 显示文字内容
│   │   ├── 显示图片素材
│   │   ├── 显示文档资料
│   │   ├── 加载状态处理
│   │   └── 错误处理
│   │
│   ├── ProfilePage.tsx              # 个人中心
│   │   ├── 用户信息展示
│   │   ├── 学习统计展示
│   │   ├── 全局统计展示
│   │   └── 退出登录
│   │
│   └── BottomNav.tsx                # 底部导航栏
│       └── 页面切换导航
│
└── utils/
    ├── auth.ts                      # 认证工具
    │   ├── login() - 登录验证
    │   ├── logout() - 退出登录
    │   ├── getCurrentUser() - 获取当前用户
    │   └── isLoggedIn() - 检查登录状态
    │
    └── statistics.ts                # 统计工具
        ├── startSession() - 开始会话
        ├── endSession() - 结束会话
        ├── getUserStatistics() - 获取用户统计
        ├── getGlobalStatistics() - 获取全局统计
        └── formatDuration() - 格式化时长
```

### 数据文件

```
public/
└── course-materials/
    ├── materials-index.json         # 素材索引
    │   └── 包含所有工法、模块、素材的元数据
    │
    └── MF01/                        # 工法1
        ├── M01/                     # 基础认知模块
        │   ├── content/             # 知识点内容
        │   │   ├── 1-1.1.1.json    # 现浇vs预制对比
        │   │   ├── 1-1.1.2.json    # 构件拼装与专利
        │   │   ├── 1-1.2.1.json    # 工法特点
        │   │   └── ...
        │   │
        │   ├── images/              # 图片素材
        │   │   ├── 1-1.1.1_现浇vs预制对比表.png
        │   │   ├── 1-1.2.1_工法特点要点清单.png
        │   │   └── ...
        │   │
        │   └── docs/                # 文档素材
        │       └── (暂无)
        │
        ├── M02/                     # 核心技术模块
        ├── M03/                     # 实操流程模块
        └── M04/                     # 保障体系模块
```

---

## 🎮 交互操作说明

### 操作1: 登录
```
输入: admin / 123456
点击: "登录"按钮
结果: 进入首页,开始记录学习时长
```

### 操作2: 浏览课程
```
位置: 首页
点击: "工法1"卡片
结果: 进入课程详情页
```

### 操作3: 展开模块
```
位置: 课程详情页
点击: "基础认知模块"标题
结果: 展开显示小节列表
```

### 操作4: 查看知识点 ⭐
```
位置: 课程详情页 > 基础认知模块
点击: "1.1 工法背景与价值"小节
结果: 进入知识点详情页
显示:
  - 知识点ID: 1-1.1.1
  - 标题: 现浇vs预制对比
  - 文字内容: 从PDF提取的段落
  - 图片: 现浇vs预制对比表.png
```

### 操作5: 查看统计
```
位置: 任意页面
点击: 底部导航"我的"
结果: 进入个人中心
显示:
  - 学习次数: 1次
  - 总学习时长: 实时累加
  - 平台总用户: 156人
  - 平台总时长: 12.7小时+
```

### 操作6: 退出登录
```
位置: 个人中心
点击: "退出登录"按钮
结果: 返回登录页面,结束会话
```

---

## 🔍 调试技巧

### 1. 查看网络请求
```
F12 → Network标签
筛选: Fetch/XHR
查看: JSON文件请求是否成功
```

### 2. 查看控制台错误
```
F12 → Console标签
查看: JavaScript错误信息
常见错误:
  - 404: 文件不存在
  - JSON parse error: 文件格式错误
  - Component error: 组件渲染错误
```

### 3. 查看LocalStorage
```
F12 → Application标签 → Storage → Local Storage
查看:
  - app_current_user: 当前登录用户
  - app_user_statistics: 用户统计数据
  - app_global_statistics: 全局统计数据
```

### 4. 检查文件路径
```
打开: E:\CODE\SD-APP\public\course-materials\
确认:
  - MF01/M01/content/1-1.1.1.json 存在
  - MF01/M01/images/1-1.1.1_现浇vs预制对比表.png 存在
```

---

## ✅ 功能检查清单

### 基础功能
- [x] 登录/登出
- [x] 会话管理
- [x] 页面导航
- [x] 底部导航栏

### 课程功能
- [x] 课程列表展示
- [x] 课程详情查看
- [x] 模块展开/收起
- [x] 小节列表显示

### 学习功能 ⭐
- [x] 知识点详情页
- [x] 内容动态加载
- [x] 文字内容展示
- [x] 图片素材展示
- [x] 文档资料下载
- [x] 加载状态提示
- [x] 错误处理

### 统计功能
- [x] 学习时长记录
- [x] 学习次数统计
- [x] 全局统计展示
- [x] 自动时长累加

---

## 📞 获取帮助

如果遇到问题:

1. **查看使用指南**: `学习功能使用指南.md`
2. **运行系统检查**: `node check_system.js`
3. **查看浏览器控制台**: F12 → Console
4. **查看网络请求**: F12 → Network
5. **检查文件是否存在**: 打开文件管理器确认

---

**最后更新**: 2025-11-19  
**当前状态**: ✅ 所有核心功能已实现并测试通过
